  {% include head.html %}
  </head>
  <body class="global landing">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    {% if site.pagebar %}
    {% include page-bar.html %}
    <div class="pusher">
    {% endif %}
        {% include landing-header.html %}
        <div class="ui vertical segment">
          <div class="ui page grid">
            <div class="column">
              <div class="ui centered inline inverted dimmer">
                <div class="ui text loader">Your browser is now assembling the table contents, it will take a few moments ...</div>
              </div>
              <div class="row">
                <p></p>
              </div>
              <div class="row">
                <table id="ranking" class="ui striped collapsing very compact small celled table"><thead><tr>
                  {% for column in page.columns %}
                  <th>{{ column }}</th>
                  {% endfor %}
                </tr></thead>
                </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% include footer.html %}
    {% if site.pagebar %}
    </div>
    {% endif %}

    {% include js.html %}
    <script src='/js/dist/sql-wasm.js'></script>
    <script>

    $('.page.dimmer:first')
      .dimmer('toggle');

    function ranking(db) {
      var dbresult = db.prepare("{{ page.dbquery }}");
      dbresult.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}
      dbresult.bind({$start:1, $end:2});
      cnt = 0;
      var e = document.createElement("tbody");
      while(dbresult.step()) {
        var row = dbresult.getAsObject();
        cnt += 1;
        e.innerHTML += `{{ page.htmltemplate }}`
      }
      return e;
    };

    $(document).ready(function() {
      $('.ui.dimmer').dimmer('show');
      config = {locateFile: filename => `/js/dist/${filename}`};
      // The `initSqlJs` function is globally provided by all of the main dist files if loaded in the browser.
      // We must specify this locateFile function if we are loading a wasm file from anywhere other than the current html page's folder.
      initSqlJs(config).then(function(SQL){

        var xhr = new XMLHttpRequest();
        xhr.open('GET', dblocation, true);
        xhr.responseType = 'arraybuffer';
        xhr.onreadystatechange = function() {
          if (this.readyState == 4)
          {
              if (this.status == 200)
              {
                var uInt8Array = new Uint8Array(this.response);
                var db = new SQL.Database(uInt8Array);
                document.getElementById("ranking").appendChild(ranking(db));
                console.log("Done");
                $('.ui.dimmer').dimmer('hide');
              }
          }
        }
        xhr.send();
      });
    });
    </script>
  </body>
</html>
