    {% include head.html %}
    <style>
      #gaps {font-size: 0.8em; font-family: monospace; font-weight: bold; white-space: pre;}
      #gaps .item { padding: 0 0.3em; margin: 0 0.3em;}
    </style>
  </head>

  <body class="global landing">
    <!--[if lt IE 7]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    {% if site.pagebar %}
    {% include page-bar.html %}
    <div class="pusher">
    {% endif %}
        {% include landing-header.html %}
        {{ content }}
        {% include footer.html %}
    {% if site.pagebar %}
    </div>
    {% endif %}
    
    {% include js.html %}
    <script src='/js/dist/sql-wasm.js'></script>
    <script>

    // Convenenience function, courtesy of StackOverflow (I'm not proud)
    const truncate = (input) => input.length > 80 ? `${input.substring(0, 80)}...` : input;


    $(document).ready(function() {
      $('.ui.dimmer').dimmer('show');
      // We must specify this locateFile function if we are loading a wasm file from 
      // anywhere other than the current html page's folder.
      config = {locateFile: filename => `/js/dist/${filename}`};

      // The `initSqlJs` function is globally provided by all of the main dist files
      // if loaded in the browser.
      initSqlJs(config).then(function(SQL){

        // Pro tem and changeable, ofc
        var sqlitedblocation = 'https://minkiz.co/library/gaplist.db';

        // standard modus operandi for getting over-the-wire data
        var xhr = new XMLHttpRequest();
        xhr.open('GET', sqlitedblocation, true);
        xhr.responseType = 'arraybuffer';

        xhr.onreadystatechange = function() {
          if (this.readyState == 4)
          {
            if (this.status == 200)
            {

              // Get sqlite to retrieve the data from the sqlite database
              var uInt8Array = new Uint8Array(this.response);
              var db = new SQL.Database(uInt8Array);
              var stmt = db.prepare("SELECT gapsize, ismax, merit, primecat, isfirst, primecert, discoverer, year, primedigits, startprime FROM gaps ORDER BY gapsize asc");
              stmt.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}
              stmt.bind({$start:1, $end:2});

              // Retrieve the holding UL element from the DOM
              var gaplist = document.getElementById("gaps")
              cnt = 1;
              html = '';
              // Create the line item element
              c = document.createDocumentFragment();
              // e = document.createElement("div");
              e = document.createElement("p");
              e.className = "concise";
              // Iterate over the Objects returned by slqite, marshalling the data, 
              while(stmt.step()) {
                cnt += 1;
                var row = stmt.getAsObject();
                // Most of the aftergoing could/should be split out
                // into a separate function (with row and gaplist as params)
                if (row['ismax'] > 0)
                  ismax = '* '
                else
                  ismax = '  '
                // Assemble the text content in T.R. Nicely format
                if (row["gapsize"] > 999999)
                  padstart = 5;
                else
                  padstart = 6;
                html += `${row["gapsize"].toString().padStart(padstart, " ")}${ismax}${row["primecat"]}${row["isfirst"]}${row["primecert"]}  ${row["discoverer"].toString().padEnd(8, " ")}  ${row["year"]} ${row["merit"].toFixed(2).toString().padStart(5, " ")} ${row["primedigits"].toString().padStart(6, " ")} ${truncate(row["startprime"])}<br/>`;
                // // DEV: Terminate the while loop and output the results thus far
                // if (cnt == 2000) {
                //   console.log(html)
                //   break;
                // }
              };
              // Insert the assembled content into the LI line item
              e.innerHTML = html;
              c.appendChild(e);
              gaplist.appendChild(c);
              $('.ui.dimmer').dimmer('hide');
            }
          }
        }

        // Actually get the data - slightly orphaned down here but critical nonetheless
        xhr.send();

      });
    });
    </script>
  </body>
</html>
